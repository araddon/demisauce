<%namespace name="mns_us" file="../usersite_bits.html"/>
<%namespace name="mns_help" file="help_bits.html"/>
<%inherit file="../_base2col.html"/>


<%def name="title()">Help Ticket Processing </%def>



<%def name="help_process(item)">
    % if item:
        <div class="clear"></div>
        <dl>
            % if item.isuser:
            <dt>Name:</dt>             <dd><a href="/account/view/${item.person_id}" body="#ticket_person_details_body" id="ticket_person_details">${item.authorname}</a></dd>
            % else:
            <dt>Name:</dt>             <dd>${item.authorname}</dd>
            % endif
            <dt>Email:</dt>            <dd>${item.email}</dd>
            <dt>url:</dt>              <dd>${item.url}</dd>
            <dt>Content:</dt>          <dd>${item.content}</dd>
            <dt>More..:</dt>          <dd><a href="#" id="ticket_details" body="#ticket_details_body" >details</a></dd>
            <!--<dt>Status:</dt>           <dd>${item.status}</dd>-->
        </dl>
        <div class="clear"></div>
        <div id="ticket_person_details_body" style="display:none;">
            % if item.person:
                ${mns_us.personview(item.person,showedit=False)}
            % endif
        </div>
        <div id="ticket_details_body" style="display:none;">
            these are more of the ticket details
            <dl>
                % if item.isuser:
                <dt>Name:</dt>             <dd><a href="/account/view/${item.person_id}">${item.authorname}</a></dd>
                % else:
                <dt>Name:</dt>             <dd>${item.authorname}</dd>
                % endif
                <dt>Email:</dt>            <dd>${item.email}</dd>
                <dt>IP:</dt>               <dd>${item.ip}</dd>
                <dt>url:</dt>              <dd>${item.url}</dd>
                <dt>Content:</dt>          <dd>SELECT users.id AS users_id, users.name AS users_name, users.fullname AS users_fullname, addresses_1.id AS addresses_1_id, addresses_1.user_id AS addresses_1_user_id, addresses_1.email_address AS addresses_1_email_address 
                FROM users LEFT OUTER JOIN addresses AS addresses_1 ON users.id = addresses_1.user_id 
                WHERE users.name = :users_name_1 AND (EXISTS (SELECT addresses_1.id 
                FROM addresses AS addresses_1 
                WHERE addresses_1.user_id = users.id AND addresses_1.email_address LIKE :addresses_email_address_1)) ORDER BY users.fullname DESCe </dd>
                <dt>Status:</dt>           <dd>${item.status_text}</dd>
            </dl>
        </div>
        ${h.form(h.url(action='process'), method='post',id='help_process_form')}
            <input type="hidden" id="help_id" name="help_id" value="${(item and item.id) or '0'}" />

             <div id="form_tabs_div" class="boxlinks_tabs boxlinks actionbar">
                <a class="current" href="#tab1">Review</a>
                <a href="#tab2">Respond</a>
             </div>
            <div class="base_form main_form" style="padding:10px" id="FormWrapper">
                <div id="tab1" style="display:show">
                    <div class="required">
                        <label for="tags">tagging:</label>
                        <div id="tag_list_div" class="tag_selections" style="line-height:2.2em; margin-left:0px;">
                        ${h.tag_links(site_id=c.site_id,tag_type='help',tags=[],cachetime=-5)}
                        </div>
                        ${h.text_field('tags', value='enter your comma separated tags', class_="hint")}
                        <br />
                    </div>
                </div>
                <div id="tab2" style="display:none;">
                    <div class="required">
                        <label for="title">Title of Response:</label>
                        ${h.text_field('title', value='')}
                    </div>
                    <div class="required">
                        <label for="response">Response:</label>
                        ${h.text_area("response", content='enter your response here', size="50x5", class_="hint")}
                    </div>
                    <div  style="margin-top:8px; min-height:75px;">
                        <div class="required">
                            <fieldset style="padding:6px;"> 
                                <legend>Publish This Response to Help Repository?</legend>
                                ${h.radio_button('publish', '1',checked=True)} Yes 
                                ${h.radio_button('publish', '0',checked=False)} No 
                            </fieldset> 
                        </div>
                    </div>
                </div>
                <div  style="margin-top:8px; min-height:75px;">
                    <div class="required half_width">
                        <fieldset style="padding:6px;"> 
                            <legend>Status of this Ticket<img alt="help?" title="Status determine's if this shows in the list needing work" 
                                src="/images/icon_help.png" class="demisauce_help_tip" /></legend>
                                <input type="radio" id="status" name="status" value="0" ${(((item.status == 0) and "CHECKED") or '')} /> New <br />
                                <input type="radio" id="status" name="status" value="1" ${(((item.status == 1) and "CHECKED") or '')} /> Assigned <br />
                                <input type="radio" id="status" name="status" value="10" ${(((item.status == 10) and "CHECKED") or '')} /> Completed <br />
                        </fieldset> 
                    </div>
                    <div class="required half_width" id="assign_ticket">
                        <fieldset style="padding:6px;"> 
                            <a href="" >Assign This ticket</a>
                                <img alt="help?" title="Puts a task in their inbox and notifies them to review this ticket" 
                                    src="/images/icon_help.png" class="demisauce_help_tip" />
                                <div id="assign_ticket_show" style="display:none;">
                                    stuff
                                </div>
                        </fieldset> 
                    </div>
                </div>
                <div class="actions submit">
                    <input type="submit" class="primary" id="submit" value="Save &amp; Next &#187;">
                    &nbsp;&nbsp;<a href="/helpadmin" id="cancelnode">cancel</a>
                </div>
            </div>
            <%
                c.tag_jsarray = ','.join(['"%s"' % tag.value for tag in item.tags])
            %>
            <script type="text/javascript">
            $(document).ready(function(){
                $('#form_tabs_div').ds_tabs();
                $('div #assign_ticket').click(function(){
                    $('div',$(this)).show();
                    return false;
                });
                $('#tag_list_div').dstags({tags:[${c.tag_jsarray}]});
                
                $.tooltip.defaults.width = '400';
                $("#ticket_details").tooltip({
                   extraClass: 'miniwin'
                });
                var person_details = '';
                $('#ticket_person_details').tooltip({
                   extraClass: 'miniwin',
                   showURL: false
                });
            });
            </script>
        ${h.end_form()}
    % endif
</%def>

<div>
    <div class="bar1">
        <span class="h3">Help And Feedback Page</span>
        <span >
            Feedback 22 of 45 <a href="/helpadmin/process/previous" id="">&#171; Previous</a>  <a href="/helpadmin/next/" id="">Next &#187;</a>
        </span>
    </div>
    
    % if c.item:
    ${help_process(c.item)}
    % elif c.helptickets:
        yes, help tickets
    % endif
    
    
</div>



<%def name="sidebar_top()">
    <div class="bar1">
        <span class="h3">Filter By</span>
    </div>
    <br />
    <div class="bar1">
        <ul class="topnav right" style="position:relative;margin-top:-1px;font-size:83%;">
            <li><a href="/helpadmin/cloud" class="${h.is_current(['helpadmin/cloud'])}">Cloud</a></li>
            <li><a href="?filter=new" class="${h.is_current(['filter=new'])}">New</a></li>
            <li><a href="?filter=completed" class="${h.is_current(['filter=completed'])}">complete</a></li>
            <li><a href="?filter=recent" class="${h.is_current(['filter=recent'])}">recent</a></li>
        </ul>
        <span class="h3">&nbsp;</span>
    </div>
    <br />
    <div class="bar1">
        <span class="h3">Comments on This Feedback</span>
    </div>
    ${h.text_area("comment", size="32x5", class_="hint")}
    
    
    % if c.item and c.item.isuser:
    <br />
    <div class="box2" style="margin: 10px 0px; padding:5px">
        <span class="h3">Other Issues from ${c.item.person.displayname}</span>
        ${mns_us.helplist(c.item.others,showcheck=False)}
    </div>
    % endif
</%def>

