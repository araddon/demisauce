(function(a){a.ds=a.ds||{};a.extend(a.ds,{parseUri:function(f){if(f==undefined){f=window.location.href}var e={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var b=e.parser[e.strictMode?"strict":"loose"].exec(f),d={},c=14;while(c--){d[e.key[c]]=b[c]||""}d[e.q.name]={};d[e.key[12]].replace(e.q.parser,function(h,g,i){if(g){d[e.q.name][g]=i}});return d},defaults:{logon_form_loaded:false,logon_form_selector:"#ds-logonform-div",logon_form_cancel:"#ds-showinputform-link",logon_form_link:"#ds-logon-link",input_form_selector:"#ds-inputform-div",current_url:"",use_sub_domains:false,base_url:"http://localhost:4950",site_slug:"enter your site id here"},prepLogon:function(c){a(c).append('<div id="ds-logonform-div" style="display:none;"></div>                 <a href="javascript:void(0);" id="ds-logon-link" >Show Logon</a>                 <a href="javascript:void(0);" id="ds-showinputform-link" style="display:none;">Cancel</a>');var b=this;var d=this.defaults;a(d.logon_form_link).click(function(){b.showLogon()});a(d.logon_form_cancel).click(function(){b.hideLogon()})},showLogon:function(){var c=this;var d=this.defaults;if(d.logon_form_loaded==true){}else{d.logon_form_loaded=true;var b="url="+encodeURIComponent(window.location.href);a(d.logon_form_selector).html('<iframe width="100%" height="150" frameborder="0"                     src="'+d.base_url+"/comment/login?"+b+'" allowtransparency="true"                     vspace="0" hspace="0" marginheight="0" marginwidth="0" id="ds-input-loginform" ></iframe>')}a(d.input_form_selector+","+d.logon_form_link).hide();a(d.logon_form_selector+","+d.logon_form_cancel).show()},hideLogon:function(){var b=this;var c=this.defaults;a(c.input_form_selector+","+c.logon_form_link).show();a(c.logon_form_selector+","+c.logon_form_cancel).hide()},service_url:function(d,e){var b=a.ds.parseUri(window.location.href);var c=this.defaults.base_url+d+"/"+encodeURIComponent(this.defaults.site_slug)+"?";c+=a.param({ref_url:(b.protocol+"://"+b.authority+b.relative),site_slug:this.defaults.site_slug});return c},dsactivity:function(f){var g=a.extend({use_url:false,activity:null,absolute:false,unique_id:null,category:null,custom:null},f);var e="";var b=a.ds.parseUri(window.location.href);var h={};var d=this.service_url("/apipublic/activity",true);if(g.use_url==true){if(g.absolute==true){g.activity=b.protocol+"://"+b.authority}g.activity+=b.relative}d+="&activity="+encodeURIComponent(g.activity);h=a.extend(h,{activity:g.activity});if(g.unique_id!=null){h=a.extend(h,{unique_id:g.unique_id})}if(g.category!=null){h=a.extend(h,{category:g.category})}if(g.custom!=null){var i="";for(var c in g.custom){i+=c+",";h[c]=g.custom[c]}h=a.extend(h,{cnames:i})}if(g.activity!=null){a.getJSON(d+"&jsoncallback=?",a.param(h),function(j){alert("success or failure?"+j)})}}});a.fn.dsactivity=function(b){var d={};var c=a.extend(d,b);this.each(function(){var e=a(this);e.click(function(){if(e.attr("activity")){c.activity=e.attr("activity");a.ds.dsactivity(c)}else{c.activity=this.textContent;a.ds.dsactivity(c)}});e.submit(function(){alert("in submit of form activity")})})};a.fn.dspoll=function(b){return this.each(function(){if(!a(this).is("ds-dspoll")){new a.ds.dspoll(this,b)}})};a.ds.dspoll=function(d,c){var e=a.extend({view_selector:".ds-poll-results-target",poll_id:0,getremote:""},a.ds.defaults,c);this.element=d;var b=this;this.poll_id=a("#poll_id",a(b.element)).val();this.q_id=a("#q_id",a(b.element)).val();b.options=e;a.data(this.element,"ds-dspoll",this);if(e.getremote!==""){b.display(d,e.getremote)}a("div.ds-poll-vote a",a(b.element)).click(function(){b.show_results()});a("div.ds-poll-vote input",a(b.element)).click(function(){b.vote(this)});return this};a.extend(a.ds.dspoll.prototype,{show_results:function(c){var b=this;a("div.ds-poll-vote,.ds-poll-question",a(b.element)).hide();a(this.options.view_selector,a(b.element)).children().show();return this},vote:function(d){var b=this;var e=a(".ds-poll-question div input[@checked]",a(b.element)).val();var f={poll_id:b.poll_id,q_id:this.q_id,options:e};var c=b.options.base_url+"/pollpublic/vote";a.getJSON(c+"?jsoncallback=?",f,function(g){a(b.element).hide();a(b.element).after(g.html);a("#"+g.htmlid).show();a.ds.dsactivity({activity:"User Voted On"+g.key,category:"Poll"})})},display:function(d,e){var b=this;var c=this.options.base_url+"/pollpublic/display/"+e;a.getJSON(c+"?jsoncallback=?",{},function(f){a(d).append(f.html);if(b.options.success){b.options.success()}if(a.browser.safari){a("style",a(d)).each(function(){a("head").append('<style id="injectedCss" type="text/css">'+a(this).text()+"</style>");a(this).text("")})}})}});a.fn.dshints=function(c,b){var d=a.extend({hint_selector:".hint",hint_class:"hint"},b);a(d.hint_selector,this).each(function(){a(this).attr("hint",a(this).val())});a(d.hint_selector,this).focus(function(){if(a(this).hasClass(d.hint_class)&&(a(this).val()==a(this).attr("hint"))){a(this).val("");a(this).removeClass(d.hint_class)}});a(d.hint_selector,this).blur(function(){if(a(this).val()==""){a(this).val(a(this).attr("hint")).addClass(d.hint_class)}});a(this).submit(function(){a(d.hint_selector,this).each(function(){if(a(this).val()==a(this).attr("hint")){a(this).val("")}})})};a.fn.comments=function(b){return this.each(function(){if(!a(this).is(".ds-comments")){new a.ds.comments(this,b)}})};a.ds.comments=function(d,e){var c={commentiframe:true};a.ds.defaults.current_url=window.location.href;e=e||{};a.extend(c,a.ds.defaults,e);this.element=d;var b=this;a.data(this.element,"ds-comments",this);b.options=c;a.ds.prepLogon(this.element);if(e.commentiframe===false){a(a.ds.defaults.logon_form_link).click(function(){a.ds.showLogon();a("#ds-commentform-div",a(b.element)).hide()});a(a.ds.defaults.logon_form_cancel).click(function(){a("#ds-commentform-div",a(b.element)).show()});a("#commentform").submit(function(){var f=a(this).formSerialize();var g=a.ds.defaults.base_url+"/comment/commentsubmitjsonp/${c.site.slug}?jsoncallback=?&"+f;a.getJSON(g,{},function(h){a("#ds-commentform-div").html(h.html)});return false})}};a.fn.dsgroupac=function(b){};a.fn.dshelp=function(b){b=a.ds.faceboxmanager.prepare_help_facebox(b);return this.each(function(){if(!a(this).is(".ds-help")){new a.ds.help(this,b)}})};a.ds.faceboxmanager={defaults:{style:"facebox",rating:false,feedback:true,draggable:true,topinfo:false,resizable:true,script:false,content:{},use_current_url:false,source_url:"",url:"",help_url:"/api/json/help/root/help",help_popup_url:"/help/submitfeedback",faceboxprecontent:"#facebox_precontent_holder",faceboxcontent:"#facebox_content_holder",faceboxcontent2:"#facebox_content_holder2",isshown:false,isinitialized:false},groupac:function(){jQuery.facebox(this.get_groupac());a("#facebox .content").before('<div id="facebox_precontent_holder"></div>');a("#facebox").css({left:((window.innerWidth-670)/2),width:670,height:500});a("#facebox_precontent_holder").css({width:630})},load:function(c,b){if(c in this.defaults.content){alert("already here"+b)}else{this.defaults.content[c]=b}},get_groupac:function(){var c=this;var b="site_key&"+a.ds.defaults.site_slug;b+="&url="+c.defaults.url;return'<div id="ds-inputform-div"><iframe width="100%" height="420" width="570" frameborder="0"             src="'+a.ds.defaults.base_url+"/groupadmin/popup/"+a.ds.defaults.site_slug+"?"+b+'"              allowtransparency="true" vspace="0" hspace="0" marginheight="0" marginwidth="0"             name="ds-input-form"></iframe></div>'},prepare_help_facebox:function(c){var d=a.extend({},this.defaults,c);var b=this;b.options=d;if(d.use_current_url==true){d.script=true,result=a.ds.parseUri(window.location.href);d.url=a.ds.defaults.base_url+d.help_url+result.relative.replace("#","");d.source_url=result.relative}return d}};a.ds.help=function(e,d){var f=a.extend({isloaded:false,hotkeys:false,showtitle:false},a.ds.faceboxmanager.defaults,d);this.element=e;var c=this;c.options=f;var b=(f.style==="facebox");if((f.style==="facebox")){a(e).click(function(){c.load_content();return false});if(f.hotkeys===true){if(typeof(a.hotkeys)!="undefined"){a.hotkeys.add("Shift+?",{disableInInput:true,type:"keypress"},function(){if(a.facebox.settings.isshown==false){c.load_content()}else{a.facebox.settings.isshown=false;a("#facebox .close").trigger("click")}})}}}else{if(f.style=="popup"){a(e).click(function(){var g=a.ds.parseUri(window.location.href);var h=a.ds.defaults.base_url+f.help_popup_url+"/"+encodeURIComponent(a.ds.defaults.site_slug)+"?";h+=a.param({ref_url:(g.protocol+"://"+g.authority+g.relative),site_slug:a.ds.defaults.site_slug});window.open(h,"mywindow","location=1,status=1,scrollbars=1,width=500,height=400")})}}return this};a.extend(a.ds.help.prototype,{load_content:function(){var b=this;a.facebox.loading();if(b.options.isloaded===false&&b.options.topinfo){a.getJSON(b.options.url+"?jsoncallback=?",{},function(e){b.topcontent=e.html;b.options.isloaded=true;a(b.options.faceboxprecontent).append(b.topcontent)})}jQuery.facebox("");if(typeof a.fn.draggable!="undefined"){a("#facebox").draggable()}a(document).bind("close.facebox",function(){b.on_close();a("#facebox_precontent_holder").remove();a("#facebox_content_holder2").remove();a("#facebook_esc_close").remove()});a("#facebox .content").before('<div id="facebox_precontent_holder"></div>');a("#facebox .content").after('<div id="facebox_content_holder2"></div>');a("#facebox .footer").prepend('<span id="facebook_esc_close" class="" style="float:left;text-align:left;">ESC = Close this panel</span>');if(b.options.isloaded===false){b.options.isloaded=true}a("#facebox").css({left:((window.innerWidth-670)/2),width:670});a("#facebox_precontent_holder").css({width:630});if(b.options.topinfo){a(b.options.faceboxprecontent).append(b.topinfo())}if(b.options.rating){a(b.options.faceboxcontent2).append(b.rating());var d=false;a(".rating input",a(b.options.faceboxcontent2)).click(function(){if(d===false){b.rate(this)}})}a("img",a("#facebox")).each(function(){result=a.ds.parseUri(this.src);url=a.ds.defaults.base_url+result.relative;this.src=url});var c="help";if(b.options.showtitle){c=a(this.element).attr("category");a(b.options.faceboxprecontent).append("<h3>"+a(this.element).html()+"</h3>")}if(b.options.feedback){a(b.options.faceboxcontent2).append(b.feedback(c))}a.ds.prepLogon(a("#facebox_content_holder2"))},on_close:function(b){},rate:function(e){var b=this;var d=a("#ds-cms-collection").attr("rid");var f=(a(e).val()==="Yes")?"1":"-1";a(e).parent().parent().hide();var c=a.ds.service_url("/help/ratearticle",true);a.getJSON(c+"&jsoncallback=?",{resource_id:d,rating:f},function(g){a.ds.dsactivity({activity:"User submitted a rating on help",category:"Help"})})},topinfo:function(){return'<div class="help-header" style="float:right;">                 <img style="vertical-align: top;" src="http://www.demisauce.com/images/icon_help.png" alt="Help" />             </div>'},rating:function(){return'<div class="rating" style="text-align:right;margin:10px 0 0 0;">                 <h4>Was This Information Helpful?</h4>                 <form>                        <input id="helpful_yes" class="buttonx" type="button"  value="Yes" name="helpful"/>                         <input id="helpful_no" class="buttonx" type="button"  value="No" name="helpful"/>                 </form></div>'},feedback:function(d){var c=this;var b="site_key="+a.ds.defaults.site_slug;b+="&url="+c.options.url+"&category="+d;return'<div id="ds-inputform-div" ttestatt="fake" style="width:630;"><iframe width="100%" height="200" frameborder="0"             src="'+a.ds.defaults.base_url+"/help/feedback/"+a.ds.defaults.site_slug+"?"+b+'"              allowtransparency="true" vspace="0" hspace="0" marginheight="0" marginwidth="0"             name="ds-input-form"></iframe></div>'},xxxhideHelp:function(){var b=this;b.options.isshown=false;a(b.options.helpselector).hide()},xxxxshowHelp:function(){var b=this;a(b.options.helpselector).show();a.hotkeys.add("Esc",{disableInInput:true},function(){b.hideHelp()});a("a.close_help,a.demisauce-close-help").click(function(){b.hideHelp()});b.options.isshown=true}});a.fn.dstags=function(b){return this.each(function(){if(!a(this).is(".ds-tag-helper")){new a.ds.tag_helper(this,b)}})};a.ds.tag={defaults:{tag_div_selector:"#tag_list_div",tagged_class:"tagged_wdelete",tag_input:"#tags",id:"tbd"}};a.ds.tag_helper=function(f,d){var b=this;d=a.extend({tags:[],tagd:{}},a.ds.tag.defaults,d);b.first_tag=true;b.element=f;b.options=d;a.data(this.element,".ds-tag-helper",this);var c=d.tags;for(var e=0;e<c.length;e++){b.add_tag(c[e])}var b=this;a("a",a(f)).click(function(){b.click_tag(a(this).html())})};a.extend(a.ds.tag_helper.prototype,{add_tag:function(b){var c=this;if(c.first_tag===true){a(c.options.tag_input).focus();c.first_tag=false}if(b.indexOf(":")>0){a("#tag_"+b.replace(":","")).addClass(c.options.tagged_class)}else{a("#tag_"+b).addClass(c.options.tagged_class)}if(!(b in c.options.tagd)){c.options.tagd[b]=b;c.options.tags[c.options.length]=b}var d=",";var e=a(c.options.tag_input).val();if(e==""){d=""}a(c.options.tag_input).val(e+d+b)},click_tag:function(b){var c=this;if(!(b in c.options.tagd)){c.add_tag(b)}else{delete c.options.tagd[b];var e=[];for(var d in c.options.tagd){e[e.length]=d}c.options.tags=e;if(b.indexOf(":")>0){a("#tag_"+b.replace(":","")).removeClass(c.options.tagged_class)}else{a("#tag_"+b).removeClass(c.options.tagged_class)}a(c.options.tag_input).val(e.join(","))}}})})(jQuery);